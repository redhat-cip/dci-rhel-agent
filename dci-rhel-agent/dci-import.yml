---
- name: Start dci-downloader
  delegate_to: beaker_server
  environment:
    - DCI_CLIENT_ID: "{{ hostvars.localhost.dci_client_id }}"
    - DCI_API_SECRET: "{{ hostvars.localhost.dci_api_secret }}"
    - DCI_CS_URL: "{{ hostvars.localhost.dci_cs_url }}"
  shell: /bin/dci-downloader {{ local_repo }} {{ topic }} {{ " ".join("--arch %s" % a for a in archs) if archs else "" }} {{ " ".join("--variant %s" % v for v in variants) if variants else "" }}  {{ --debug if debug else "" }}
  become: true
  when: hostvars.localhost.skip_download == False

- name: Import the latest build
  delegate_to: beaker_server
  shell: beaker-import -v --ignore-missing-tree-compose "http://{{ local_repo_ip }}/{{ topic }}/compose/"
  become: true
