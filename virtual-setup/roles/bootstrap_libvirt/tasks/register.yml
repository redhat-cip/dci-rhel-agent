---
- name: Get facts for the management network
  virt_net:
    command: facts
    name: management

- name: Set fact for the jumpbox management ip
  set_fact:
    jumpbox_ip_addr: "{{ item['ipaddr'] }}"
  loop: "{{ ansible_libvirt_networks['management']['dhcp_leases'] }}"
  when: item['hostname'] == "jumpbox"

- name: Add the jumpbox to the ansible inventory
  add_host:
    hostname: jumpbox
    ansible_host: '{{ jumpbox_ip_addr }}'
    ansible_user: dci

- name: Wait for ssh to come up
  wait_for: host="{{ jumpbox_ip_addr }}" port=22 delay=10  timeout=300