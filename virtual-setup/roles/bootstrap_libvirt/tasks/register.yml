---
- name: Get facts for the default network
  virt_net:
    command: facts
    name: default

- name: Set fact for the jumpbox default ip
  set_fact:
    jumpbox_ip_addr: "{{ item['ipaddr'] }}"
  loop: "{{ ansible_libvirt_networks['default']['dhcp_leases'] }}"
  when: item['hostname'] == "jumpbox"

- name: Add the jumpbox to the ansible inventory
  add_host:
    hostname: jumpbox
    ansible_host: '{{ jumpbox_ip_addr }}'
    ansible_user: dci
    ansible_ssh_private_key_file: '{{ host_ssh_key_path }}'

- name: Wait for ssh to come up
  wait_for: host="{{ jumpbox_ip_addr }}" port=22 delay=10  timeout=300
