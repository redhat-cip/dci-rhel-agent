---
- name: Install HWCert repos
  yum_repository:
    name: hwcert
    description: hwcert YUM repo
    baseurl: http://{{local_repo_ip}}/hwcert
    gpgcheck: no

- name: Install extraOS
  yum_repository:
    name: extraOS
    description: extraos YUM repo
    baseurl: http://{{local_repo_ip}}/extraos
    gpgcheck: no

- name: Install EPEL
  yum_repository:
      name: EPEL
      description: EPEL repo
      baseurl: http://download.fedoraproject.org/pub/epel/7/x86_64
      gpgcheck: no

- name: Copy HWcert
  copy:
    src: /usr/share/dci-rhel-agent/hwcert-sti
    dest: /opt/

- name: Copy cert package
  copy:
    src: /usr/share/dci-rhel-agent/redhat-certification-hardware-spicegate.noarch.rpm
    dest: /opt/

- name: Copy copr package
  copy:
    src: /usr/share/dci-rhel-agent/yum-plugin-copr.noarch.rpm
    dest: /opt/

- name: Install needed packages
  yum:
    name: "{{ packages }}"
    disable_gpg_check: yes
  vars:
    packages:
    - /opt/yum-plugin-copr.noarch.rpm
    - /opt/redhat-certification-hardware-spicegate.noarch.rpm

- name: Launch test
  command: ansible-playbook --tags classic tests.yml
  args:
    chdir: /opt/hwcert-sti
